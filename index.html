<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Internet Nodes Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #graph { width: 100vw; height: 100vh; }
        .node { stroke: #fff; stroke-width: 1.5px; }
        .link { stroke: #999; stroke-opacity: 0.6; }
    </style>
</head>
<body>
    <h1>Interactive Graph of Internet Nodes from PeeringDB</h1>
    <svg id="graph"></svg>
    <script>
        const baseUrl = 'https://www.peeringdb.com/api';
        const apiKey = 'XKDJWVre';  // Replace with your actual API key

        async function loadData() {
            try {
                const response = await fetch(`${baseUrl}/ix`, {
                    headers: {
                        'Authorization': `Api-Key ${apiKey}`
                    }
                });
                const data = await response.json();
                createGraph(data.data);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        function createGraph(ixData) {
            const nodes = ixData.map((ix, i) => ({
                id: i,
                name: ix.name,
                city: ix.city,
                country: ix.country
            }));

            // Create sample links for demonstration (e.g., connect to next node)
            const links = [];
            for (let i = 0; i < nodes.length - 1; i++) {
                links.push({ source: i, target: i + 1 });
            }

            const svg = d3.select('#graph');
            const width = window.innerWidth;
            const height = window.innerHeight;

            svg.attr('width', width).attr('height', height);

            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2));

            const link = svg.append('g')
                .attr('class', 'links')
                .selectAll('line')
                .data(links)
                .enter().append('line')
                .attr('class', 'link');

            const node = svg.append('g')
                .attr('class', 'nodes')
                .selectAll('circle')
                .data(nodes)
                .enter().append('circle')
                .attr('class', 'node')
                .attr('r', 5)
                .attr('fill', 'steelblue')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            node.append('title')
                .text(d => `${d.name}, ${d.city}, ${d.country}`);

            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);
            });

            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }

        loadData();
    </script>
</body>
</html>
