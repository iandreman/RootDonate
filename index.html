<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hello World â€¢ Email â†’ GPS Map â€¢ #MUFC</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5p5QbskXk=" crossorigin="anonymous"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <style>
    body, html { margin:0; padding:0; height:100%; background:#000; color:#eee; font-family:system-ui, sans-serif; }
    #map { height:100%; }
    .overlay {
      position: absolute; top:10px; left:50%; transform:translateX(-50%);
      z-index:1000; background:rgba(0,0,0,0.75); padding:12px 20px; border-radius:12px;
      text-align:center; max-width:90%; box-shadow:0 4px 15px rgba(0,200,100,0.2);
    }
    h1 { margin:0 0 8px; font-size:2.2rem; background:linear-gradient(90deg, #0af, #0f5, #f90); -webkit-background-clip:text; background-clip:text; color:transparent; }
    input, button { margin:5px; padding:8px 14px; border-radius:8px; border:1px solid #444; background:#222; color:#fff; }
    button { background:#1d9bf0; border:none; cursor:pointer; font-weight:600; }
    button:hover { background:#0c85d0; }
    #status, #gps { font-size:0.9rem; color:#0f5; margin:6px 0; }
    .error { color:#f66; }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="overlay">
    <h1>Hello World Map</h1>
    <div>
      <input id="msg" placeholder="Your message / shoutout..." style="width:220px;"/>
      <label><input type="checkbox" id="media"> Has media?</label>
    </div>
    <button id="add">Add to Map + Email</button>
    <button id="refresh">Refresh (test posts)</button>
    <button id="zoom">Zoom to Carrington</button>
    <div id="gps">GPS: checking...</div>
    <div id="status">Jan 21, 2026 â€¢ @iandreme â€¢ Email â†’ Map demo</div>
  </div>

  <script>
    // Replace with **your own** EmailJS values
    emailjs.init({ publicKey: "1oXeNo5ZXiRcipyWo" });  // â† your public key

    const map = L.map('map').setView([53.4631, -2.2913], 13);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: 'Â© OpenStreetMap & CARTO'
    }).addTo(map);

    const greenDot = L.divIcon({
      className: 'dot',
      html: '<div style="background:#0f5;width:18px;height:18px;border-radius:50%;border:3px solid #fff;box-shadow:0 0 8px #0f5;"></div>',
      iconSize: [18,18],
      iconAnchor: [9,9]
    });

    let myLat = 53.4631;
    let myLng = -2.2913;

    // Try to get real location
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(pos => {
        myLat = pos.coords.latitude;
        myLng = pos.coords.longitude;
        document.getElementById('gps').textContent = `GPS: ${myLat.toFixed(5)}, ${myLng.toFixed(5)}`;
      }, () => {
        document.getElementById('gps').textContent = 'GPS off â€” using default (Carrington)';
      }, { enableHighAccuracy: true, timeout: 8000 });
    } else {
      document.getElementById('gps').textContent = 'No GPS support';
    }

    function addMarker(lat, lng, text, hasMedia) {
      const popup = `
        <b>@iandreme</b><br>
        ${text || '(no message)'}<br>
        ${hasMedia ? 'ğŸ“¸ Has media' : ''}<br>
        <small>${new Date().toLocaleString()}</small>
      `;
      L.marker([lat, lng], { icon: greenDot }).addTo(map).bindPopup(popup);
    }

    // Add your message
    document.getElementById('add').onclick = () => {
      const text = document.getElementById('msg').value.trim();
      if (!text) {
        alert('Write something first!');
        return;
      }

      const hasMedia = document.getElementById('media').checked;

      // Show on map
      addMarker(myLat, myLng, text, hasMedia);

      // Send via EmailJS
      emailjs.send('service_amql3dos', 'template_cyl5hjt', {  // â† change service & template IDs
        text: text,
        lat: myLat.toFixed(6),
        lng: myLng.toFixed(6),
        hasMedia: hasMedia ? 'Yes' : 'No',
        from_name: 'Hello World Map User'
      }).then(() => {
        alert('Added to map + emailed successfully!');
        document.getElementById('msg').value = '';
      }).catch(err => {
        alert('Email failed â€“ check console & EmailJS setup');
        console.error('EmailJS error:', err);
      });
    };

    // Test / dummy refresh
    document.getElementById('refresh').onclick = () => {
      const status = document.getElementById('status');
      status.className = '';
      status.textContent = 'Showing test markers...';

      // Clearâ€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹