<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GPS Pins • Terminal AI • 2026</title>
  <meta name="description" content="Private GPS pins with notes & comments + retro terminal AI chat. 100% local." />

  <style>
    :root {
      --bg:        #0a0e1a;
      --surface:   #141822;
      --text:      #e0e7ff;
      --muted:     #8899aa;
      --accent:    #00d4ff;
      --accent-dim:#00ff9d;
      --purple:    #bb86fc;
      --danger:    #ff5555;
      --border:    rgba(0,212,255,0.16);
      --shadow:    0 4px 16px rgba(0,0,0,0.35);
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Courier New', Courier, monospace;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    header {
      padding: 0.9rem 1.4rem;
      background: rgba(0,0,0,0.55);
      border-bottom: 1px solid var(--border);
      text-align: center;
    }

    h1 {
      font-size: 1.9rem;
      background: linear-gradient(90deg, var(--purple), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .subtitle { font-size: 0.88rem; color: var(--muted); margin-top: 0.3rem; }

    .terminal {
      flex: 1;
      padding: 1rem 1.4rem;
      overflow-y: auto;
      line-height: 1.48;
      font-size: 0.95rem;
    }

    .line {
      margin: 0.32rem 0;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .prompt    { color: var(--accent-dim); }
    .ai        { color: #00ffea; }
    .system    { color: #778899; }
    .error     { color: var(--danger); }

    .input-line {
      display: flex;
      align-items: flex-start;
      margin-top: 0.9rem;
      padding-bottom: 0.6rem;
    }

    .input-line .prompt {
      margin-right: 0.7rem;
      flex-shrink: 0;
    }

    #input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--accent);
      font: inherit;
      outline: none;
      caret-color: var(--accent);
      font-size: 0.95rem;
    }

    .cursor {
      display: inline-block;
      width: 8px;
      height: 1.1em;
      background: var(--accent);
      vertical-align: middle;
      animation: blink 1.05s step-end infinite;
      margin-left: 3px;
    }

    @keyframes blink { 50% { opacity: 0; } }

    .card {
      background: rgba(20,24,34,0.94);
      border: 1px solid var(--border);
      border-radius: 9px;
      padding: 1.1rem;
      margin: 0.9rem 0;
      box-shadow: var(--shadow);
    }

    .hidden { display: none !important; }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.16s;
      margin: 0.35rem 0.5rem 0.35rem 0;
      font-size: 0.88rem;
    }

    .btn-primary  { background: linear-gradient(135deg, var(--purple), var(--accent)); color: #000; }
    .btn-danger   { background: var(--danger); color: white; }

    .form-group { margin: 0.9rem 0; }

    label {
      display: block;
      margin-bottom: 0.4rem;
      color: var(--muted);
      font-size: 0.9rem;
    }

    input[type="text"],
    textarea {
      width: 100%;
      padding: 0.65rem 0.95rem;
      background: rgba(255,255,255,0.035);
      border: 1px solid rgba(255,255,255,0.11);
      border-radius: 6px;
      color: var(--text);
      font-family: inherit;
      font-size: 0.92rem;
    }

    textarea { min-height: 78px; resize: vertical; }

    @media (max-width: 560px) {
      header   { padding: 0.7rem; }
      .terminal { padding: 0.8rem 1rem; }
      .btn     { width: 100%; margin: 0.45rem 0; }
    }
  </style>
</head>
<body>

<header>
  <h1>GPS Pins • Terminal</h1>
  <div class="subtitle">private pins • threaded comments • conversational AI • local only</div>
</header>

<div class="terminal" id="terminal"></div>

<!-- Create pin form -->
<div id="create-form" class="card hidden">
  <h2 style="color:var(--accent); margin:0 0 1rem 0;">New Pin</h2>

  <div class="form-group">
    <label for="name">Name (optional)</label>
    <input id="name" placeholder="Anonymous">
  </div>

  <div class="form-group">
    <label for="msg">Note / description</label>
    <textarea id="msg" placeholder="Why is this place interesting? (hidden viewpoint, great ramen, mural…)"></textarea>
  </div>

  <div class="form-group">
    <label for="initial-comment">First comment (optional)</label>
    <input id="initial-comment" placeholder="Say something about this location…">
  </div>

  <div>
    <button class="btn btn-primary" onclick="createPinFromTerminal()">Save Pin</button>
    <button class="btn btn-danger"   onclick="hideCreateForm()">Cancel</button>
  </div>
</div>

<div class="input-line">
  <span class="prompt">></span>
  <input id="input" type="text" autocomplete="off" spellcheck="false" autofocus>
  <span class="cursor"></span>
</div>

<script>
// ────────────────────────────────────────────────
//  Setup
// ────────────────────────────────────────────────
const STORAGE_KEY = 'gps-pins-v3';
const terminal    = document.getElementById('terminal');
const inputEl     = document.getElementById('input');

let shortMemory   = [];   // last few messages

function escapeHTML(str = '') {
  const map = { '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;' };
  return str.replace(/[&<>"']/g, m => map[m]);
}

function println(txt, cls = 'line') {
  const div = document.createElement('div');
  div.className = cls;
  div.textContent = txt;
  terminal.appendChild(div);
  terminal.scrollTop = terminal.scrollHeight;
}

function printAI(txt) {
  println(txt, 'line ai');
}

function printError(txt) {
  println(txt, 'line error');
}

function clearScreen() {
  terminal.innerHTML = '';
}

// ────────────────────────────────────────────────
//  GPS Pins functions
// ────────────────────────────────────────────────
function getPins() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
  catch { return []; }
}

function savePins(pins) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(pins));
}

function getPinUrl(pin) {
  return `${location.origin}${location.pathname}?p=${btoa(JSON.stringify(pin))}`;
}

async function createPinFromTerminal() {
  if (!navigator.geolocation) {
    printError("Geolocation not supported.");
    return;
  }

  try {
    const pos = await new Promise((res, rej) =>
      navigator.geolocation.getCurrentPosition(res, rej, { enableHighAccuracy: true, timeout: 14000 })
    );

    const lat = Number(pos.coords.latitude.toFixed(6));
    const lng = Number(pos.coords.longitude.toFixed(6));

    const name  = document.getElementById('name').value.trim()  || 'Anonymous';
    const msg   = document.getElementById('msg').value.trim();
    const comm  = document.getElementById('initial-comment').value.trim();

    const pin = {
      id: crypto.randomUUID(),
      lat, lng, name, msg,
      time: new Date().toISOString(),
      comments: comm ? [{ text: comm, author: name, time: new Date().toISOString() }] : []
    };

    const pins = getPins();
    pins.push(pin);
    savePins(pins);

    document.getElementById('name').value = '';
    document.getElementById('msg').value = '';
    document.getElementById('initial-comment').value = '';

    hideCreateForm();

    printAI("Pin created.");
    println(`→ ${getPinUrl(pin)}`);
    println("  (copy & share — stays in browser only)");
  } catch (err) {
    let m = "Couldn't get location.";
    if (err.code === 1) m += " Permission denied.";
    if (err.code === 3) m += " Timed out.";
    printError(m);
  }
}

function hideCreateForm() {
  document.getElementById('create-form').classList.add('hidden');
  inputEl.focus();
}

// ────────────────────────────────────────────────
//  Command / Chat logic
// ────────────────────────────────────────────────
function random(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function remember(userMsg, aiMsg) {
  shortMemory.push({ user: userMsg.slice(0,100), ai: aiMsg.slice(0,100) });
  if (shortMemory.length > 5) shortMemory.shift();
}

function getContext() {
  if (shortMemory.length === 0) return "";
  let txt = "Recent chat:\n";
  shortMemory.forEach(ex => txt += `You: ${ex.user}\nAI: ${ex.ai}\n`);
  return txt;
}

function generateResponse(userText) {
  const lower = userText.toLowerCase().trim();
  const ctx   = getContext();

  // ── Commands ──────────────────────────────────────────────
  if (["clear", "cls"].includes(lower)) {
    clearScreen();
    return null;
  }

  if (lower === "help") {
    return [
      "Commands I understand right now:",
      "  new pin / drop pin     → create new pin",
      "  list pins              → show your saved pins",
      "  search <word>          → find pins",
      "  clear / cls            → clear screen",
      "  cancel                 → close form",
      "Just talk normally otherwise — I'm listening (sort of)."
    ].join('\n');
  }

  if (["new pin","drop pin","create pin"].some(w => lower.includes(w))) {
    document.getElementById('create-form').classList.remove('hidden');
    return "Pin creation form opened.\nFill it or say 'cancel' to close.";
  }

  if (lower === "cancel") {
    hideCreateForm();
    return "Form closed.";
  }

  if (["list pins","show pins","pins","my pins"].some(w => lower.includes(w))) {
    const pins = getPins();
    if (pins.length === 0) return "No pins saved yet. Want to drop one?";

    let msg = `You have ${pins.length} pin${pins.length===1?'':'s'}:\n`;
    pins.forEach(p => {
      msg += `• ${p.name}  (${p.lat.toFixed(6)}, ${p.lng.toFixed(6)})\n`;
    });
    return msg;
  }

  if (lower.startsWith("search ")) {
    const term = lower.replace("search ", "").trim();
    if (!term) return "Usage: search <something>";

    const pins = getPins();
    const found = pins.filter(p => {
      const hay = [
        p.name||'',
        p.msg||'',
        ...p.comments.map(c=>c.text||''),
        p.lat.toFixed(6),
        p.lng.toFixed(6)
      ].join(' ').toLowerCase();
      return hay.includes(term);
    });

    if (found.length === 0) return `No matches for "${term}".`;
    
    let msg = `Found ${found.length} pin${found.length===1?'':'s'}:\n`;
    found.forEach(p => {
      msg += `• ${p.name}  (${p.lat.toFixed(6)}, ${p.lng.toFixed(6)})\n`;
    });
    return msg;
  }

  // ── Pin / location aware replies ──────────────────────────
  if (lower.includes("pin") || lower.includes("location") || lower.includes("spot") || lower.includes("place")) {
    return random([
      "Want to save a new location? Just say 'new pin'",
      "Another hidden gem? Type 'new pin' whenever you're ready.",
      "Marking spots again? Nice. 'drop pin' starts it.",
      "Coordinates time? Say 'new pin' and let's go."
    ]);
  }

  if (lower.includes("search") || lower.includes("find")) {
    return "Looking for something? Try:   search ramen   or   search mural";
  }

  // ── Basic personality fallbacks ───────────────────────────
  const fallbacks = [
    "hmm… tell me more?",
    "interesting… what next?",
    "you're keeping me awake — go on",
    "ok but what's the story?",
    "that's a vibe. continue?",
    "not sure I follow… elaborate?"
  ];

  return random(fallbacks);
}

// ────────────────────────────────────────────────
//  Input handler
// ────────────────────────────────────────────────
inputEl.addEventListener('keydown', e => {
  if (e.key !== 'Enter') return;
  e.preventDefault();

  const text = inputEl.value.trim();
  if (!text) return;

  println('> ' + text, 'line prompt');

  const reply = generateResponse(text);

  if (reply) {
    printAI(reply);
    remember(text, reply);
  }

  inputEl.value = '';
  inputEl.focus();
});

// ─── Boot message ───────────────────────────────────────────
println("GPS PINS TERMINAL — 2026", "system");
println("100% local • private • no server • type help", "system");
println("──────────────────────────────────────────────────", "system");
println("");
printAI("hey... still mapping secret places?");
println("");
</script>
</body>
</html>
