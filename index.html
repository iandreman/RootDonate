<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Internet Nodes Visualization - RootDonate</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        header h1 {
            margin: 0;
            font-size: 2rem;
        }
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }
        #graph-container {
            width: 100%;
            max-width: 1200px;
            height: 70vh;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        #graph {
            width: 100%;
            height: 100%;
        }
        .description {
            max-width: 800px;
            text-align: center;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: auto;
        }
        .node {
            stroke: #fff;
            stroke-width: 1.5px;
            fill: #3498db;
        }
        .node:hover {
            fill: #2980b9;
        }
        .link {
            stroke: #bdc3c7;
            stroke-opacity: 0.6;
        }
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }
            .description {
                font-size: 1rem;
            }
            #graph-container {
                height: 60vh;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>RootDonate - Interactive Internet Nodes Visualization</h1>
    </header>
    <main>
        <p class="description">
            Explore the interconnected world of internet nodes through this interactive visualization powered by PeeringDB data. Each node represents an Internet Exchange (IX), with connections illustrating the flow of data between them.
        </p>
        <div id="graph-container">
            <svg id="graph"></svg>
        </div>
    </main>
    <footer>
        <p>&copy; 2025 RootDonate. Data sourced from PeeringDB. 100% uptime.</p>
    </footer>
    <script>
        const baseUrl = 'https://www.peeringdb.com/api';
        const apiKey = 'XKDJWVre';  // Replace with your actual API key

async function loadData() {
    try {
        const response = await fetch(`${baseUrl}/ix`);
        const data = await response.json();
        createGraph(data.data);
    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

        function createGraph(ixData) {
            const nodes = ixData.map((ix, i) => ({
                id: i,
                name: ix.name,
                city: ix.city,
                country: ix.country
            }));

            // Create sample links for demonstration (e.g., connect to next node)
            const links = [];
            for (let i = 0; i < nodes.length - 1; i++) {
                links.push({ source: i, target: i + 1 });
            }

            const svg = d3.select('#graph');
            const container = document.getElementById('graph-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            svg.attr('width', width).attr('height', height);

            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(50))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2));

            const link = svg.append('g')
                .attr('class', 'links')
                .selectAll('line')
                .data(links)
                .enter().append('line')
                .attr('class', 'link');

            const node = svg.append('g')
                .attr('class', 'nodes')
                .selectAll('circle')
                .data(nodes)
                .enter().append('circle')
                .attr('class', 'node')
                .attr('r', 6)
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            node.append('title')
                .text(d => `${d.name}\n${d.city}, ${d.country}`);

            simulation.on('tick', () => {
                link
                    .attr('x1', d => Math.max(6, Math.min(width - 6, d.source.x)))
                    .attr('y1', d => Math.max(6, Math.min(height - 6, d.source.y)))
                    .attr('x2', d => Math.max(6, Math.min(width - 6, d.target.x)))
                    .attr('y2', d => Math.max(6, Math.min(height - 6, d.target.y)));

                node
                    .attr('cx', d => Math.max(6, Math.min(width - 6, d.x)))
                    .attr('cy', d => Math.max(6, Math.min(height - 6, d.y)));
            });

            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }

        loadData();
    </script>
</body>
</html>
