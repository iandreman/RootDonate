<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RootDonate - Live X Posts Map â€¢ Carrick Era @ MUFC â€“ GPS Nodes from X</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5p5QbskXk=" crossorigin="anonymous" />
  <style>
    body, html {
      margin: 0;
      height: 100%;
      background: #000;
      color: #fff;
      font-family: system-ui, sans-serif;
      overflow: auto;
    }
    #map-container {
      position: relative;
      height: 80vh;
    }
    #map {
      height: 100%;
    }
    .header {
      position: absolute;
      top: 12px;
      left: 0;
      right: 0;
      text-align: center;
      pointer-events: none;
      z-index: 1000;
    }
    h1 {
      font-size: 2.8rem;
      font-weight: 900;
      letter-spacing: -1px;
      background: linear-gradient(90deg, #0af, #0f5, #f90);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px;
      background: rgba(0, 0, 0, 0.8);
      text-align: center;
      font-size: 0.9rem;
      z-index: 1000;
    }
    button {
      padding: 10px 20px;
      background: #1d9bf0;
      border: none;
      color: white;
      border-radius: 9999px;
      cursor: pointer;
      margin: 5px;
      font-weight: 600;
    }
    button:hover {
      background: #1a8cd8;
    }
    input {
      margin: 5px;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #333;
      background: #222;
      color: #fff;
      font-size: 1rem;
    }
    label {
      pointer-events: all;
      margin-right: 8px;
    }
    .post-section {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }
    #gpsStatus {
      font-size: 0.9rem;
      color: #0f5;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <div id="map-container">
    <div id="map"></div>

    <div class="header" style="pointer-events: all;">
      <h1>RootDonate</h1>
      <label for="keyword">Search Keyword:</label>
      <input id="keyword" placeholder="e.g., training, Carrington, Amad" aria-label="Search keyword for posts" />
      <button id="loadButton">Load X Posts</button>
      <button id="zoomButton">Zoom to Carrington</button>

      <div class="post-section">
        <label for="postText">Your Post:</label>
        <input id="postText" placeholder="Type your post..." style="min-width: 220px;" aria-label="Enter your post text" />
        <label for="hasMedia">Include Media?</label>
        <input type="checkbox" id="hasMedia" aria-label="Include media in post" />
        <button id="addPostButton">Add Post to Map</button>
        <span id="gpsStatus">GPS Status: Checking...</span>
      </div>
    </div>

    <footer>
      <span id="status">Jan 21, 2026 ~07:11 GMT â€¢ @iandreme (Swagga Rico) â€¢ #MUFC Carrick Era â€¢ X Posts as GPS Nodes</span>
    </footer>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
  <script>
    // Map Setup
    const map = L.map('map').setView([53.4631, -2.2913], 11);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: 'Â© OpenStreetMap & CARTO'
    }).addTo(map);

    // Custom icons
    const userIcon = L.divIcon({
      html: '<div style="width:56px;height:56px;border-radius:50%;overflow:hidden;border:3px solid #0af;box-shadow:0 0 12px #0af"><img src="https://pbs.twimg.com/profile_images/1452130026212765700/q9iBQMu8_400x400.jpg" alt="User profile image" style="width:100%;height:100%;object-fit:cover"></div>',
      iconSize: [56, 56],
      iconAnchor: [28, 28],
      className: ''
    });

    const xPostIcon = L.divIcon({
      html: '<div style="background:#000;border:2px solid #1da1f2;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;color:#1da1f2;font-weight:bold">X</div>',
      iconSize: [44, 44],
      iconAnchor: [22, 22],
      className: ''
    });

    const postsLayer = L.layerGroup().addTo(map);
    let userMarker = null;
    let currentLat = 53.4631;
    let currentLng = -2.2913;
    let gpsActive = false;

    // Sample real X posts data (hardcoded for demonstration; can be expanded or fetched dynamically)
    const realXPosts = [
      { u: 'SkySportsPL', t: 'Michael Carrick takes charge of training for the first time with his new coaching staff at Manchester UnitedðŸ”´', url: 'https://x.com/SkySportsPL/status/2011484158585905614', lat: 53.4631, lng: -2.2913, hasMedia: true },
      { u: 'UtdAngle', t: 'ðŸ“¸ðŸ’ª Michael Carrick\'s first training session. #mufc', url: 'https://x.com/UtdAngle/status/2011479145994195066', lat: 53.4631, lng: -2.2913, hasMedia: true }
    ];

    let userPosts = JSON.parse(localStorage.getItem('userPosts')) || [];

    // Update user marker position
    function updateUserMarker(lat, lng) {
      currentLat = lat;
      currentLng = lng;
      if (userMarker) userMarker.remove();
      userMarker = L.marker([lat, lng], { icon: userIcon }).addTo(map)
        .bindPopup("Your Location â€¢ @iandreme â€¢ Swagga Rico (Live GPS)", { autoClose: false }).openPopup();
      if (gpsActive) map.flyTo([lat, lng], 15, { duration: 1.2 });
    }

    // Add an X post marker to the map
    function addPostMarker(lat, lng, username, text, url, hasMedia) {
      const jitterLat = lat + (Math.random() - 0.5) * 0.006;
      const jitterLng = lng + (Math.random() - 0.5) * 0.009;
      const marker = L.marker([jitterLat, jitterLng], { icon: xPostIcon }).addTo(postsLayer);
      marker.bindPopup(`
        <b>@${username}</b><br>
        ${text.slice(0, 140)}${text.length > 140 ? '...' : ''}<br>
        ${hasMedia ? '<small>ðŸ“¸ / ðŸŽ¥ Media attached</small><br>' : ''}
        <small>Approximate Location: ~${lat.toFixed(4)}, ${lng.toFixed(4)}</small><br>
        <a href="${url}" target="_blank" style="color:#1da1f2">View full post on X</a>
      `);
    }

    // Load and filter posts based on keyword
    async function loadPosts(keyword = '') {
      postsLayer.clearLayers();
      document.getElementById('status').textContent = 'Loading posts...';

      const allPosts = [...realXPosts, ...userPosts];
      const filtered = allPosts.filter(p =>
        !keyword ||
        p.t.toLowerCase().includes(keyword.toLowerCase().trim()) ||
        p.u.toLowerCase().includes(keyword.toLowerCase().trim())
      );

      filtered.forEach(p => addPostMarker(p.lat, p.lng, p.u, p.t, p.url, p.hasMedia));

      document.getElementById('status').textContent =
        `${filtered.length} posts loaded â€¢ @iandreme â€¢ Carrick Era â€¢ Jan 21, 2026`;
    }

    // Live GPS tracking
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(
        pos => {
          gpsActive = true;
          updateUserMarker(pos.coords.latitude, pos.coords.longitude);
          document.getElementById('gpsStatus').textContent = 'GPS Status: Active';
          document.getElementById('gpsStatus').style.color = '#0f5';
        },
        err => {
          gpsActive = false;
          updateUserMarker(53.4631, -2.2913);
          document.getElementById('gpsStatus').textContent = 'GPS Status: Using fallback location';
          document.getElementById('gpsStatus').style.color = '#f90';
        },
        { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
      );
    } else {
      updateUserMarker(53.4631, -2.2913);
      document.getElementById('gpsStatus').textContent = 'GPS Status: Not supported';
    }

    // Add post button event listener
    document.getElementById('addPostButton').addEventListener('click', () => {
      const text = document.getElementById('postText').value.trim();
      if (!text) {
        alert("Please enter post text first.");
        return;
      }

      const newPost = {
        u: 'iandreme',
        t: text,
        url: `https://x.com/iandreme/status/${Date.now()}`,
        lat: currentLat,
        lng: currentLng,
        hasMedia: document.getElementById('hasMedia').checked
      };

      userPosts.push(newPost);
      localStorage.setItem('userPosts', JSON.stringify(userPosts));

      const keyword = document.getElementById('keyword').value.trim();
      loadPosts(keyword);

      document.getElementById('postText').value = '';
      document.getElementById('hasMedia').checked = false;
      document.getElementById('status').textContent += ' â€¢ Your post added from current location!';
    });

    // Load button event listener
    document.getElementById('loadButton').addEventListener('click', () => {
      const keyword = document.getElementById('keyword').value.trim();
      loadPosts(keyword);
    });

    // Zoom button event listener
    document.getElementById('zoomButton').addEventListener('click', () => {
      map.setView([53.4631, -2.2913], 14, { animate: true, duration: 1.5 });
    });

    // Initial load
    setTimeout(() => loadPosts(), 800);
  </script>
</body>
</html>
```â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹