<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GPS Pins â€¢ 2026</title>
  <meta name="description" content="Private GPS pins with notes & comments + retro terminal AI chat. 100% local." />

  <style>
    :root {
      --bg:        #0a0e1a;
      --surface:   #141822;
      --text:      #e0e7ff;
      --muted:     #8899aa;
      --accent:    #00d4ff;
      --accent-dim:#00ff9d;
      --purple:    #bb86fc;
      --danger:    #ff5555;
      --border:    rgba(0,212,255,0.16);
      --shadow:    0 4px 16px rgba(0,0,0,0.35);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Courier New', Courier, monospace;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 1rem 1.4rem;
      background: rgba(0,0,0,0.55);
      border-bottom: 1px solid var(--border);
      text-align: center;
    }
    h1 {
      font-size: 2rem;
      background: linear-gradient(90deg, var(--purple), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin: 0;
    }
    .subtitle { color: var(--muted); font-size: 0.9rem; margin-top: 0.4rem; }
    .tabs {
      margin: 0.8rem 0 0.4rem;
      display: flex;
      justify-content: center;
      gap: 0.6rem;
      flex-wrap: wrap;
    }
    .tab-btn {
      padding: 0.5rem 1.2rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--muted);
      cursor: pointer;
      font-weight: bold;
      transition: all 0.16s;
    }
    .tab-btn.active {
      background: linear-gradient(135deg, var(--purple), var(--accent));
      color: #000;
      border-color: transparent;
    }
    .tab-content {
      flex: 1;
      display: none;
      overflow: hidden;
      flex-direction: column;
    }
    .tab-content.active { display: flex; }

    /* Terminal styles unchanged */
    #terminal-tab .terminal {
      flex: 1;
      padding: 1rem 1.4rem;
      overflow-y: auto;
      line-height: 1.48;
      font-size: 0.95rem;
    }
    .line { margin: 0.32rem 0; white-space: pre-wrap; word-break: break-word; }
    .prompt    { color: var(--accent-dim); }
    .ai        { color: #00ffea; }
    .system    { color: #778899; }
    .error     { color: var(--danger); }
    .input-line {
      display: flex;
      align-items: flex-start;
      padding: 0.6rem 1.4rem;
      background: rgba(0,0,0,0.3);
      border-top: 1px solid var(--border);
    }
    .input-line .prompt { margin-right: 0.7rem; flex-shrink: 0; }
    #input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--accent);
      font: inherit;
      outline: none;
      caret-color: var(--accent);
    }
    .cursor {
      display: inline-block;
      width: 8px;
      height: 1.1em;
      background: var(--accent);
      animation: blink 1.05s step-end infinite;
      margin-left: 4px;
    }
    @keyframes blink { 50% { opacity: 0; } }

    /* Pins tab */
    #pins-tab {
      padding: 1.2rem;
      overflow-y: auto;
    }
    .card {
      background: rgba(20,24,34,0.94);
      border: 1px solid var(--border);
      border-radius: 9px;
      padding: 1.3rem;
      margin: 1rem 0;
      box-shadow: var(--shadow);
    }
    .pin-title { color: var(--accent); font-size: 1.3rem; margin-bottom: 0.5rem; }
    .meta { color: var(--muted); font-size: 0.9rem; margin: 0.6rem 0; }
    .note { margin: 1rem 0; white-space: pre-wrap; }
    .comments {
      margin-top: 1.2rem;
      border-top: 1px solid var(--border);
      padding-top: 1rem;
    }
    .comment {
      margin: 0.8rem 0;
      padding-left: 1rem;
      border-left: 3px solid var(--accent-dim);
    }
    #search {
      width: 100%;
      max-width: 420px;
      padding: 0.7rem;
      margin: 0 auto 1.2rem;
      display: block;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font-family: inherit;
    }
    .share-row {
      margin-top: 1.4rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem 1.2rem;
      align-items: center;
    }
    .action-btn {
      padding: 0.5rem 1.1rem;
      background: rgba(0,212,255,0.18);
      border: 1px solid var(--accent-dim);
      border-radius: 6px;
      color: var(--accent);
      font-weight: bold;
      cursor: pointer;
      transition: all 0.18s;
    }
    .action-btn:hover {
      background: rgba(0,212,255,0.35);
    }
    .action-btn.copied,
    .action-btn.email-sent {
      background: rgba(0,255,157,0.28);
      color: #00ff9d;
      border-color: #00ff9d;
    }
    .hidden { display: none !important; }

    @media (max-width: 560px) {
      .share-row { flex-direction: column; align-items: stretch; }
      .action-btn { width: 100%; text-align: center; }
    }
  </style>
</head>
<body>

<header>
  <h1>GPS Pins</h1>
  <div class="subtitle">private locations â€¢ threaded comments â€¢ local terminal AI</div>

  <div class="tabs">
    <button class="tab-btn active" data-tab="terminal">Terminal</button>
    <button class="tab-btn" data-tab="pins">My Pins</button>
  </div>
</header>

<!-- Terminal Tab -->
<div id="terminal-tab" class="tab-content active">
  <div class="terminal" id="terminal"></div>
  <div class="input-line">
    <span class="prompt">></span>
    <input id="input" type="text" autocomplete="off" spellcheck="false" autofocus>
    <span class="cursor"></span>
  </div>
</div>

<!-- Pins Tab -->
<div id="pins-tab" class="tab-content">
  <input type="text" id="search" placeholder="Search pins (name, note, commentâ€¦)">
  <div id="pins-container"></div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Shared helpers
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STORAGE_KEY = 'gps-pins-v3';

function escapeHTML(str = '') {
  const map = { '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;' };
  return str.replace(/[&<>"']/g, m => map[m]);
}

function getPins() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
  catch { return []; }
}

function savePins(pins) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(pins));
}

function getPinShareUrl(pin) {
  return `${location.origin}${location.pathname}#p=${btoa(JSON.stringify(pin))}`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Terminal logic (unchanged except small tweak to print URL)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const terminal = document.getElementById('terminal');
const inputEl  = document.getElementById('input');

let shortMemory = [];

function println(txt, cls = 'line') {
  const div = document.createElement('div');
  div.className = cls;
  div.innerHTML = txt;
  terminal.appendChild(div);
  terminal.scrollTop = terminal.scrollHeight;
}

function printAI(txt) { println(txt, 'line ai'); }
function printError(txt) { println(txt, 'line error'); }
function clearScreen() { terminal.innerHTML = ''; }

async function createPinFromPrompts() {
  const name = prompt("Pin name (optional):")?.trim() || 'Anonymous';
  const msg  = prompt("Note / description:")?.trim() || '';
  const comm = prompt("First comment (optional):")?.trim() || '';

  if (!navigator.geolocation) return printError("Geolocation not supported.");

  try {
    const pos = await new Promise((res, rej) =>
      navigator.geolocation.getCurrentPosition(res, rej, { enableHighAccuracy: true, timeout: 14000 })
    );

    const lat = Number(pos.coords.latitude.toFixed(6));
    const lng = Number(pos.coords.longitude.toFixed(6));

    const pin = {
      id: crypto.randomUUID(),
      lat, lng, name, msg,
      time: new Date().toISOString(),
      comments: comm ? [{ text: comm, author: name, time: new Date().toISOString() }] : []
    };

    const pins = getPins();
    pins.push(pin);
    savePins(pins);

    const shareUrl = getPinShareUrl(pin);

    printAI(`Pin created: ${escapeHTML(name)}`);
    println(`â†’ <a href="${shareUrl}" style="color:var(--accent);">${shareUrl}</a>`, 'line ai');
    println(`(view/copy/share from My Pins tab)`);
  } catch (err) {
    let m = "Couldn't get location.";
    if (err.code === 1) m += " Permission denied.";
    if (err.code === 3) m += " Timed out.";
    printError(m);
  }
}

// ... (rest of generateResponse, input listener, boot messages unchanged - keep your existing ones)


// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Pins Tab + Email / Copy features
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function copyToClipboard(text, button, successText = 'Copied!') {
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(text).then(() => showFeedback(button, successText));
  } else {
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed'; ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showFeedback(button, successText);
  }
}

function showFeedback(btn, text) {
  const original = btn.textContent;
  btn.textContent = text;
  btn.classList.add('copied');
  setTimeout(() => {
    btn.textContent = original;
    btn.classList.remove('copied');
  }, 2200);
}

function getEmailBody(pin) {
  const url = getPinShareUrl(pin);
  let body = `Hey,\n\nCheck out this pin I saved:\n\n`;

  body += `ðŸ“ ${escapeHTML(pin.name || 'Anonymous')}\n`;
  body += `   ${pin.lat.toFixed(6)}, ${pin.lng.toFixed(6)}\n`;
  body += `   Created: ${new Date(pin.time).toLocaleString()}\n\n`;

  if (pin.msg) body += `Note:\n${escapeHTML(pin.msg)}\n\n`;

  if (pin.comments.length) {
    body += `Comments:\n`;
    pin.comments.forEach(c => {
      body += `â€¢ ${escapeHTML(c.text)} (${escapeHTML(c.author || 'anon')}, ${new Date(c.time).toLocaleString()})\n`;
    });
    body += `\n`;
  }

  body += `Open in GPS Pins app:\n${url}\n\n`;
  return body;
}

function renderPins(pinsToShow = getPins()) {
  const container = document.getElementById('pins-container');
  container.innerHTML = pinsToShow.length === 0
    ? '<p style="color:var(--muted); text-align:center; margin:4rem 0;">No pins yet. Create one in Terminal tab.</p>'
    : pinsToShow.map(pin => {
        const shareUrl = getPinShareUrl(pin);
        const emailSubject = encodeURIComponent(`GPS Pin: ${pin.name || 'Hidden Spot'}`);
        const emailBody = encodeURIComponent(getEmailBody(pin));
        const mailto = `mailto:?subject=${emailSubject}&body=${emailBody}`;

        return `
          <div class="card">
            <div class="pin-title">${escapeHTML(pin.name || 'Anonymous')}</div>
            <div class="meta">${pin.lat.toFixed(6)}, ${pin.lng.toFixed(6)} â€¢ ${new Date(pin.time).toLocaleString()}</div>
            ${pin.msg ? `<div class="note">${escapeHTML(pin.msg)}</div>` : ''}
            ${pin.comments.length ? `
              <div class="comments">
                <strong>Comments (${pin.comments.length})</strong>
                ${pin.comments.map(c => `
                  <div class="comment">
                    ${escapeHTML(c.text)}<br>
                    <small style="color:var(--muted);">â€” ${escapeHTML(c.author || 'anon')}, ${new Date(c.time).toLocaleString()}</small>
                  </div>
                `).join('')}
              </div>
            ` : ''}
            <div class="share-row">
              <button class="action-btn" data-action="copy" data-url="${shareUrl}">Copy URL</button>
              <button class="action-btn" data-action="copy-email" data-pin-id="${pin.id}">Copy Email Text</button>
              <a href="${mailto}" class="action-btn" style="text-decoration:none;">Email this Pin</a>
            </div>
          </div>
        `;
      }).join('');

  // Event listeners
  container.querySelectorAll('[data-action="copy"]').forEach(btn => {
    btn.addEventListener('click', () => {
      copyToClipboard(btn.getAttribute('data-url'), btn);
    });
  });

  container.querySelectorAll('[data-action="copy-email"]').forEach(btn => {
    btn.addEventListener('click', () => {
      const pinId = btn.getAttribute('data-pin-id');
      const pin = getPins().find(p => p.id === pinId);
      if (pin) {
        copyToClipboard(getEmailBody(pin), btn, 'Email text copied!');
      }
    });
  });
}

// Search, tab switching, hashchange handler (keep your existing code here)

// Initial render & handlers setup (keep your existing tab/hash logic)
document.querySelector('[data-tab="pins"]').addEventListener('click', () => renderPins());
// ... rest of your script ...
</script>
</body>
</html>
