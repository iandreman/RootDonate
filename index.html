<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Find All GPS Pins ‚Ä¢ Swagga Rico</title>
  <style>
    body {
      background: #0a0a12;
      color: #e0e0ff;
      font-family: 'Segoe UI', system-ui, sans-serif;
      margin: 0;
      padding: 20px;
      line-height: 1.5;
    }
    h1 {
      color: #34d399;
      text-align: center;
      margin-bottom: 0.5em;
      font-size: 2.8rem;
      text-shadow: 0 0 15px rgba(52,211,153,0.5);
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    #controls {
      display: flex;
      gap: 12px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    input, button {
      padding: 12px 16px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #444;
    }
    input {
      background: #111;
      color: white;
      border-color: #555;
      flex: 1;
      min-width: 200px;
    }
    button {
      background: linear-gradient(45deg, #7c3aed, #3b82f6);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { opacity: 0.9; }
    button#clear { background: #ef4444; }
    #status {
      margin: 15px 0;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      display: none;
    }
    #status.success { background: rgba(52,211,153,0.2); color: #34d399; }
    #status.error   { background: rgba(239,68,68,0.2); color: #ef4444; }
    .pin-list {
      display: grid;
      gap: 16px;
    }
    .pin {
      background: rgba(255,255,255,0.04);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid rgba(120,80,255,0.15);
    }
    .from {
      font-weight: bold;
      color: #a78bfa;
      margin-bottom: 6px;
    }
    .msg {
      margin: 8px 0;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .meta {
      font-size: 0.9rem;
      color: #a0a0a0;
    }
    .coords {
      color: #4cc9ff;
      text-decoration: none;
    }
    .coords:hover { text-decoration: underline; }
    .no-pins {
      text-align: center;
      color: #888;
      padding: 40px 0;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Find All GPS Pins</h1>
    <p style="text-align:center; color:#a0a0ff;">View every pin saved in Root Donate ‚Ä¢ No radius limits</p>

    <div id="controls">
      <input type="text" id="search" placeholder="Search name, message, coords...">
      <button onclick="renderPins()">Filter</button>
      <button id="clear" onclick="clearStorage()">Clear All Pins ‚ö†Ô∏è</button>
    </div>

    <div id="status"></div>

    <div id="pin-list" class="pin-list"></div>
  </div>

  <script>
    const STORAGE_KEY = 'root_donate_pins';

    function getPins() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
      } catch {
        return [];
      }
    }

    function savePins(pins) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(pins));
    }

    function showStatus(msg, type = 'success') {
      const el = document.getElementById('status');
      el.textContent = msg;
      el.className = type;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 4000);
    }

    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
    }

    function renderPins(filter = '') {
      const pins = getPins();
      const container = document.getElementById('pin-list');
      container.innerHTML = '';

      if (pins.length === 0) {
        container.innerHTML = '<div class="no-pins">No pins found in localStorage yet üå±</div>';
        return;
      }

      const term = filter.toLowerCase().trim();
      const filtered = term
        ? pins.filter(p =>
            p.name.toLowerCase().includes(term) ||
            (p.msg || '').toLowerCase().includes(term) ||
            `${p.lat?.toFixed(6) || ''},${p.lng?.toFixed(6) || ''}`.includes(term)
          )
        : pins;

      if (filtered.length === 0) {
        container.innerHTML = '<div class="no-pins">No matching pins</div>';
        return;
      }

      filtered.sort((a, b) => new Date(b.time) - new Date(a.time)); // newest first

      filtered.forEach(p => {
        const dt = new Date(p.time).toLocaleString('en-GB', { dateStyle: 'medium', timeStyle: 'short' });
        const name = escapeHTML(p.name || 'Anonymous');
        const msg = escapeHTML(p.msg || '(no message)');
        const coords = `${p.lat.toFixed(6)}, ${p.lng.toFixed(6)}`;
        const apple = `https://maps.apple.com/?ll=${p.lat},${p.lng}&q=${encodeURIComponent(name)}`;
        const google = `https://www.google.com/maps?q=${p.lat},${p.lng}`;

        const div = document.createElement('div');
        div.className = 'pin';
        div.innerHTML = `
          <div class="from">${name}${p.auto ? ' [auto]' : ''}</div>
          <div class="msg">${msg}</div>
          <div class="meta">
            ${dt} ‚Ä¢ 
            <a href="${apple}" target="_blank" class="coords">${coords} (Apple Maps)</a>
            <br>
            <small><a href="${google}" target="_blank" style="color:#888;">(Google Maps)</a></small>
          </div>
        `;
        container.appendChild(div);
      });

      showStatus(`Showing ${filtered.length} of ${pins.length} pins`, 'success');
    }

    function clearStorage() {
      if (!confirm('Delete ALL saved pins permanently? This cannot be undone.')) return;
      localStorage.removeItem(STORAGE_KEY);
      renderPins();
      showStatus('All pins cleared', 'success');
    }

    // Init
    document.getElementById('search').addEventListener('keypress', e => {
      if (e.key === 'Enter') renderPins(document.getElementById('search').value);
    });
    renderPins(); // load all on start
  </script>
</body>
</html>