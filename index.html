<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RootDonate • Multi-World Server Footprints</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root { --blue:#0a84ff; --green:#30d158; --orange:#ff9f0a; --red:#ff453a; --purple:#ae8cff; }
    * { box-sizing:border-box; margin:0; padding:0; }
    body,html { height:100%; overflow:hidden; background:#000; color:#fff; font-family:system-ui,sans-serif; }
    #map { width:100%; height:100%; filter:brightness(0.92) contrast(1.12); }
    .header { position:absolute; top:0; left:0; right:0; padding:2.5rem 2rem 1.5rem; text-align:center; z-index:1000; pointer-events:none; background:linear-gradient(180deg,rgba(0,0,0,0.9),transparent); }
    h1 { font-size:clamp(2.8rem,7vw,4.5rem); font-weight:900; letter-spacing:-2px; background:linear-gradient(90deg,var(--blue),var(--green),var(--orange),var(--purple)); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 40px rgba(174,140,255,0.4); }
    .poem { margin-top:1rem; font-size:1.4rem; font-weight:300; opacity:0.9; }
    footer { position:absolute; bottom:0; left:0; right:0; padding:1rem; text-align:center; font-size:0.9rem; opacity:0.8; z-index:1000; background:rgba(0,0,0,0.7); backdrop-filter:blur(15px); display:flex; justify-content:center; gap:0.8rem; flex-wrap:wrap; }
    .btn, select { pointer-events:all; background:rgba(255,255,255,0.12); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.18); border-radius:10px; padding:0.5rem 1rem; font-size:0.9rem; cursor:pointer; transition:all 0.2s; color:white; }
    .btn:hover, select:hover { background:rgba(255,255,255,0.25); transform:translateY(-1px); }
    .avatar-wrapper { width:100%; height:100%; border-radius:50%; overflow:hidden; border:2.5px solid rgba(255,255,255,0.45); box-shadow:0 0 14px rgba(255,255,255,0.35); background:#111; }
    .avatar-wrapper img { width:100%; height:100%; object-fit:cover; }
    .footprint-avatar { background:transparent!important; border:none!important; pointer-events:none; }
    .footprint-avatar .avatar-wrapper { animation:fade-out 8s forwards; }
    .planet-earth .avatar-wrapper { border-color:var(--blue); box-shadow:0 0 14px var(--blue)aa; }
    .planet-mars   .avatar-wrapper { border-color:#ff6347; box-shadow:0 0 14px #ff4500aa; }
    .planet-moon   .avatar-wrapper { border-color:#b0c4ff; box-shadow:0 0 14px #6495ed88; }
    .planet-gta    .avatar-wrapper { border-color:#ff9f0a; box-shadow:0 0 14px #ff9f0aaa; }
    .user-avatar-marker { background:transparent!important; border:none!important; }
    .user-avatar { border:3.5px solid var(--blue); box-shadow:0 0 28px var(--blue); animation:pulse-blue 2.2s infinite; }
    @keyframes pulse-blue { 0%,100% { box-shadow:0 0 0 0 rgba(10,132,255,0.7); } 70% { box-shadow:0 0 0 28px rgba(10,132,255,0); } }
    @keyframes fade-out { 0% { opacity:0.85; transform:scale(0.92); } 100% { opacity:0; transform:scale(2.4); } }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="header">
    <h1>RootDonate</h1>
    <div class="poem" id="poemText">We Are All Here</div>
  </div>

  <footer>
    <span id="counter">Server connecting...</span>
    <button class="btn" id="shareFootprints">Share Trail</button>
    <button class="btn" id="refreshLocation">Respawn Crew</button>
    <button class="btn" id="clearFootprints">Clear Footprints</button>
    <select class="btn" id="planetSelector">
      <option value="earth">Earth</option>
      <option value="mars">Mars</option>
      <option value="moon">Moon</option>
      <option value="gta" selected>Los Santos (GTA V)</option>
    </select>
    <span>• 2026 • Human & AI server vibes</span>
  </footer>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const YOUR_AVATAR = "https://pbs.twimg.com/profile_images/1452130026212765700/q9iBQMu8.jpg";
    const AI_AVATAR = "https://api.dicebear.com/9.x/bottts/svg?seed=RootDonate&backgroundColor=2d3748&radius=50";

    const fakeNames = ["SwaggaRico", "BigSmoke420", "LamarDaSavage", "TrevorChaos", "FranklinOG", "AI_GhostBot", "CrewPhantom", "NoPixelLegend", "FiveMRunner"];

    const planets = {
      earth: {
        name: "Earth", poem: "We Are All Here",
        tiles: "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
        subdomains: "abcd",
        crs: L.CRS.EPSG3857, view: [51.5, -0.1], zoom: 6, maxZoom: 19,
        className: "planet-earth", spawn: geolocationSpawn
      },
      mars: {
        name: "Mars", poem: "We Will All Be There",
        tiles: "http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/celestia_mars-shaded-16k_global/{z}/{x}/{y}.png",
        crs: L.CRS.Simple, view: [0, 0], zoom: 3, maxZoom: 12,
        className: "planet-mars", spawn: randomCosmicSpawn
      },
      moon: {
        name: "Moon", poem: "We Have Been There • And Will Return",
        tiles: "https://trek.nasa.gov/tiles/Moon/EQ/LRO_WAC_Mosaic_Global_303ppd_v02/1.0.0/default/default028mm/{z}/{y}/{x}.jpg",
        crs: L.CRS.Simple, view: [0, 0], zoom: 3, maxZoom: 10,
        className: "planet-moon", spawn: randomCosmicSpawn, tms: true
      },
      gta: {
        name: "Los Santos", poem: "We Are All In Los Santos",
        tiles: "https://gta5-map.github.io/tiles/road/{z}-{x}_{y}.png",
        crs: L.CRS.Simple, view: [0, 0], zoom: 4, maxZoom: 7,
        className: "planet-gta", spawn: realisticGtaSpawn
      }
    };

    let currentPlanet = 'gta';
    let map = L.map('map', {
      crs: planets[currentPlanet].crs,
      zoomControl: false,
      minZoom: 2,
      maxZoom: planets[currentPlanet].maxZoom || 19,
      attributionControl: false
    });

    let currentLayer = L.tileLayer(planets[currentPlanet].tiles, {
      subdomains: planets[currentPlanet].subdomains || '',
      tileSize: 256,
      tms: !!planets[currentPlanet].tms
    }).addTo(map);
    map.setView(planets[currentPlanet].view, planets[currentPlanet].zoom);

    const userIcon = L.divIcon({
      className: "user-avatar-marker",
      html: `<div class="avatar-wrapper user-avatar"><img src="${YOUR_AVATAR}" alt="You"></div>`,
      iconSize: [56, 56], iconAnchor: [28, 28]
    });

    let userMarker = null;
    const footprintsLayer = L.layerGroup().addTo(map);
    const STORAGE_KEY = "rootdonate_server_footprints";

    function getFootprintIcon(type = "human") {
      const avatar = type === "ai" ? AI_AVATAR : YOUR_AVATAR;
      return L.divIcon({
        className: `footprint-avatar ${planets[currentPlanet].className}`,
        html: `<div class="avatar-wrapper"><img src="${avatar}" alt="${type}"></div>`,
        iconSize: [40, 40], iconAnchor: [20, 20]
      });
    }

    function addFootprint(lat, lng, type = "human", name = "") {
      const popup = name ? `${name} • ${type === "ai" ? "AI Ghost" : "Crew"}` : "";
      const marker = L.marker([lat, lng], { icon: getFootprintIcon(type) }).addTo(footprintsLayer);
      if (popup) marker.bindPopup(popup);
    }

    function loadFootprints() {
      footprintsLayer.clearLayers();
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        JSON.parse(stored).filter(p => p.planet === currentPlanet).forEach(p => addFootprint(p.lat, p.lng, p.type, p.name));
      }
    }

    function saveFootprint(lat, lng, type = "human", name = "") {
      let points = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      points.push({ lat, lng, time: Date.now(), planet: currentPlanet, type, name });
      if (points.length > 300) points = points.slice(-300);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(points));
      addFootprint(lat, lng, type, name);
    }

    function clearAllFootprints() {
      if (confirm("Wipe server footprints on this world?")) {
        let points = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
        points = points.filter(p => p.planet !== currentPlanet);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(points));
        footprintsLayer.clearLayers();
        alert("Streets clean. Respawn the crew!");
      }
    }

    function showUser(lat, lng, text = "You are here • right now") {
      if (userMarker) userMarker.remove();
      userMarker = L.marker([lat, lng], { icon: userIcon })
        .addTo(map)
        .bindPopup(text, { closeButton: false, autoClose: false })
        .openPopup();
      const flyZoom = currentPlanet === 'earth' ? 8 : (currentPlanet === 'gta' ? 5 : 4);
      map.flyTo([lat, lng], flyZoom, { duration: 2.5 });
    }

    // Spawns: server-like crew (your avatar + named ghosts)
    function randomCosmicSpawn() {
      const lat = (Math.random() - 0.5) * 10000;
      const lng = (Math.random() - 0.5) * 10000;
      showUser(lat, lng, `You are here • ${planets[currentPlanet].name} vibes`);
      saveFootprint(lat, lng, "human", "SwaggaRico");
      for (let i = 0; i < 15; i++) {
        const rlat = lat + (Math.random() - 0.5) * 4000;
        const rlng = lng + (Math.random() - 0.5) * 4000;
        const isAI = Math.random() > 0.5;
        const name = fakeNames[Math.floor(Math.random() * fakeNames.length)];
        saveFootprint(rlat, rlng, isAI ? "ai" : "human", name);
      }
    }

    function realisticGtaSpawn() {
      const areas = [
        {mx:100, my:-1000, s:3000}, // LS
        {mx:-2000, my:4000, s:1500}, // Sandy
        {mx:3000, my:-3000, s:1000}  // Vespucci
      ];
      const area = areas[Math.floor(Math.random()*areas.length)];
      const x = area.mx + (Math.random()-0.5)*area.s;
      const y = area.my + (Math.random()-0.5)*area.s;
      const lat = Math.max(-4000, Math.min(8000, x));
      const lng = Math.max(-4000, Math.min(6000, y));
      showUser(lat, lng, "You are here • Los Santos kingpin");
      saveFootprint(lat, lng, "human", "SwaggaRico");
      for (let i = 0; i < 15 + Math.floor(Math.random()*10); i++) {
        const a = areas[Math.floor(Math.random()*areas.length)];
        const rx = a.mx + (Math.random()-0.5)*a.s;
        const ry = a.my + (Math.random()-0.5)*a.s;
        const rlat = Math.max(-4000, Math.min(8000, rx));
        const rlng = Math.max(-4000, Math.min(6000, ry));
        const isAI = Math.random() > 0.6;
        const name = fakeNames[Math.floor(Math.random() * fakeNames.length)];
        saveFootprint(rlat, rlng, isAI ? "ai" : "human", name);
      }
    }

    async function geolocationSpawn() {
      try {
        const pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej, {enableHighAccuracy:true}));
        const lat = pos.coords.latitude, lng = pos.coords.longitude;
        showUser(lat, lng, `You are here • ±${Math.round(pos.coords.accuracy)}m`);
        saveFootprint(lat, lng, "human", "SwaggaRico");
      } catch { ipFallback(); }
    }

    function ipFallback() {
      const lat = 51.5074 + (Math.random()-0.5)*0.5;
      const lng = -0.1278 + (Math.random()-0.5)*0.5;
      showUser(lat, lng, "You are here • approx UK");
      saveFootprint(lat, lng, "human", "SwaggaRico");
    }

    // Switch planet
    document.getElementById("planetSelector").onchange = e => {
      const key = e.target.value;
      if (key === currentPlanet) return;
      currentPlanet = key;
      currentLayer.remove();
      currentLayer = L.tileLayer(planets[key].tiles, {
        subdomains: planets[key].subdomains || '',
        tileSize: 256,
        tms: !!planets[key].tms
      }).addTo(map);
      map.options.crs = planets[key].crs;
      map.setView(planets[key].view, planets[key].zoom, {duration:2});
      document.getElementById("poemText").textContent = planets[key].poem;
      userMarker?.remove(); userMarker = null;
      loadFootprints();
      planets[key].spawn();
      document.getElementById("counter").textContent = `Server crew on ${planets[key].name}`;
    };

    document.getElementById("refreshLocation").onclick = () => planets[currentPlanet].spawn();
    document.getElementById("clearFootprints").onclick = clearAllFootprints;

    document.getElementById("shareFootprints").onclick = async () => {
      const url = window.location.href;
      const p = planets[currentPlanet];
      const text = `Dropping server footprints on ${p.name}...\n"${p.poem}"\nHuman & AI crew together • RootDonate 2026\n${url}`;
      if (navigator.share) navigator.share({title:"RootDonate Server", text, url});
      else window.open(`https://twitter.com/intent/post?text=${encodeURIComponent(text)}`, '_blank');
    };

    // Init
    loadFootprints();
    planets[currentPlanet].spawn();
  </script>
</body>
</html>