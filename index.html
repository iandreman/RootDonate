<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Root Donate Drops â€¢ ~500 m GPS Pins (Local)</title>

  <style>
    html, body { margin:0; padding:0; height:100%; background:#000; color:#eee; font-family:Arial,Helvetica,sans-serif; }
    .container { max-width:580px; margin:0 auto; padding:20px; }
    h1 { text-align:center; color:#00ff55; margin:10px 0 16px; }
    input, textarea { width:100%; padding:12px; margin:10px 0; border:1px solid #444; border-radius:8px; background:#111; color:white; font-size:1em; box-sizing:border-box; }
    textarea { resize:vertical; min-height:100px; }
    .buttons { text-align:center; margin:20px 0; display:flex; flex-wrap:wrap; justify-content:center; gap:12px; }
    button { padding:13px 24px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; transition:all 0.2s; min-width:140px; }
    #dropBtn   { background:#00cc44; color:black; }
    #dropBtn:hover   { background:#00ff55; }
    #clearBtn  { background:#cc0000; color:white; }
    #clearBtn:hover  { background:#ff3333; }
    #status { text-align:center; margin:12px 0; min-height:1.4em; font-size:0.95em; }
    .success { color:#0f5; }
    .error   { color:#f66; }
    .pin-list { margin-top:16px; }
    .location-group { margin-bottom:28px; }
    .location-header { 
      background:#1a1a1a; padding:10px 14px; border-radius:8px 8px 0 0; 
      font-weight:bold; color:#0f5; border:1px solid #333; border-bottom:none; font-size:1.05em; 
    }
    .pin { 
      background:#111; border:1px solid #333; border-top:none; padding:14px 16px; margin:0; 
    }
    .pin:not(:last-child) { border-bottom:1px solid #222; }
    .pin-header { font-weight:bold; color:#55ff99; margin-bottom:6px; }
    .pin-msg { margin:8px 0 10px; white-space:pre-wrap; line-height:1.4; }
    .pin-time { font-size:0.82em; color:#777; text-align:right; margin-top:6px; }
    .info-box { background:#222; padding:12px; border-radius:8px; margin:12px 0; font-size:0.95em; line-height:1.4; }
  </style>
</head>
<body>

  <div class="container">
    <h1>Root Donate Drops âš½ #MUFC (~500 m Radius)</h1>

    <div class="info-box" id="locationInfo">
      Waiting for location...
    </div>

    <input type="text" id="name" placeholder="Name / @handle" value="@iandreme" />
    <textarea id="msg" placeholder="Your message / shoutout... (visible within ~500 m of drop location)"></textarea>
    
    <div class="buttons">
      <button id="dropBtn">Drop Message</button>
      <button id="clearBtn">Clear Drops in ~500 m</button>
    </div>
    
    <div id="status"></div>

    <div class="pin-list" id="pinList"></div>
  </div>

  <script>
    const STORAGE_KEY = 'root-donate-drops-local';
    const COORD_PRECISION = 5;          // ~1.1 m grouping precision
    const MATCH_TOLERANCE = 0.0045;     // â‰ˆ 500 meters radius (tune here)

    let userLat = null;
    let userLng = null;

    // â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function coordsMatch(aLat, aLng, bLat, bLng) {
      return Math.abs(aLat - bLat) <= MATCH_TOLERANCE && Math.abs(aLng - bLng) <= MATCH_TOLERANCE;
    }

    function roundCoord(n) {
      return Number(n.toFixed(COORD_PRECISION));
    }

    function getDrops() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch {
        return [];
      }
    }

    function saveDrops(drops) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(drops));
      window.dispatchEvent(new Event('storage'));
    }

    function addDrop(name, msg, lat, lng) {
      const drops = getDrops();
      drops.push({
        name: name || 'Anonymous',
        msg: msg || '(no message)',
        lat: roundCoord(lat),
        lng: roundCoord(lng),
        timestamp: new Date().toISOString()
      });
      saveDrops(drops);
    }

    function clearDropsNearLocation(lat, lng) {
      let drops = getDrops();
      drops = drops.filter(d => !coordsMatch(d.lat, d.lng, lat, lng));
      saveDrops(drops);
    }

    // â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderDrops() {
      const listEl = document.getElementById('pinList');
      if (userLat === null || userLng === null) {
        listEl.innerHTML = '<p style="text-align:center;color:#555;padding:20px;">Waiting for GPS...</p>';
        return;
      }

      const drops = getDrops().filter(d => coordsMatch(d.lat, d.lng, userLat, userLng));

      if (drops.length === 0) {
        listEl.innerHTML = '<p style="text-align:center;color:#555;padding:20px;">No drops within ~500 m yet â€” be the first! âš½</p>';
        return;
      }

      listEl.innerHTML = '';

      const groups = {};
      drops.forEach(d => {
        const key = `${d.lat.toFixed(5)},${d.lng.toFixed(5)}`;
        if (!groups[key]) groups[key] = [];
        groups[key].push(d);
      });

      Object.entries(groups).forEach(([key, group]) => {
        const [lat, lng] = key.split(',').map(Number);
        const groupDiv = document.createElement('div');
        groupDiv.className = 'location-group';

        groupDiv.innerHTML = `
          <div class="location-header">ğŸ“ ${lat.toFixed(5)}, ${lng.toFixed(5)} (within ~500 m)</div>
        `;

        group.sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));

        group.forEach(drop => {
          const pin = document.createElement('div');
          pin.className = 'pin';
          pin.innerHTML = `
            <div class="pin-header">${drop.name}</div>
            <div class="pin-msg">${drop.msg}</div>
            <div class="pin-time">${new Date(drop.timestamp).toLocaleString()}</div>
          `;
          groupDiv.appendChild(pin);
        });

        listEl.appendChild(groupDiv);
      });
    }

    // â”€â”€â”€ UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const statusEl = document.getElementById('status');
    function showStatus(text, cls = '') {
      statusEl.textContent = text;
      statusEl.className = cls;
      setTimeout(() => { statusEl.textContent = ''; statusEl.className = ''; }, 5000);
    }

    const locInfoEl = document.getElementById('locationInfo');

    function updateLocationInfo() {
      if (userLat === null || userLng === null) {
        locInfoEl.innerHTML = 'Waiting for precise location...';
        locInfoEl.style.color = '#777';
      } else {
        locInfoEl.innerHTML = `ğŸ“ Current: ${userLat.toFixed(5)}, ${userLng.toFixed(5)} (seeing drops within ~500 m)`;
        locInfoEl.style.color = '#0f5';
      }
    }

    // â”€â”€â”€ Geolocation watch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function startWatchingLocation() {
      if (!navigator.geolocation) {
        showStatus('Geolocation not supported', 'error');
        locInfoEl.textContent = 'Geolocation not available';
        return;
      }

      navigator.geolocation.watchPosition(
        pos => {
          userLat = pos.coords.latitude;
          userLng = pos.coords.longitude;
          updateLocationInfo();
          renderDrops();
        },
        err => {
          showStatus('Location access denied or unavailable', 'error');
          locInfoEl.textContent = 'Location not available';
        },
        {
          enableHighAccuracy: true,
          timeout: 15000,
          maximumAge: 5000
        }
      );
    }

    // â”€â”€â”€ Events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('dropBtn').addEventListener('click', () => {
      if (userLat === null || userLng === null) {
        showStatus('Waiting for GPS first', 'error');
        return;
      }
      const name = document.getElementById('name').value.trim();
      const msg  = document.getElementById('msg').value.trim();
      if (!msg) {
        showStatus('Write a message first âš½', 'error');
        return;
      }
      addDrop(name, msg, userLat, userLng);
      document.getElementById('msg').value = '';
      renderDrops();
      showStatus('Dropped! Visible in ~500 m area ğŸ“', 'success');
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      if (userLat === null || userLng === null) {
        showStatus('No location to clear', 'error');
        return;
      }
      if (!confirm('Clear ALL drops within ~500 m of here?')) return;
      clearDropsNearLocation(userLat, userLng);
      renderDrops();
      showStatus('Area drops cleared ğŸ—‘ï¸', 'success');
    });

    window.addEventListener('storage', (e) => {
      if (e.key === STORAGE_KEY) renderDrops();
    });

    // â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    startWatchingLocation();
    updateLocationInfo();
    renderDrops();
  </script>
</body>
</html>