<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hello World â€¢ Email â†’ GPS Map â€¢ #MUFC</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5p5QbskXk=" crossorigin="anonymous"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <style>
    body, html { margin:0; padding:0; height:100%; background:#000; color:#eee; font-family:system-ui, sans-serif; }
    #map { height:100%; }
    .overlay {
      position: absolute; top:10px; left:50%; transform:translateX(-50%);
      z-index:1000; background:rgba(0,0,0,0.75); padding:16px 24px; border-radius:12px;
      text-align:center; max-width:90%; box-shadow:0 4px 15px rgba(0,200,100,0.2);
    }
    h1 { margin:0 0 12px; font-size:2.4rem; background:linear-gradient(90deg, #0af, #0f5, #f90); -webkit-background-clip:text; background-clip:text; color:transparent; }
    input, textarea { 
      display:block; margin:8px auto; padding:10px; width:90%; max-width:400px;
      border-radius:8px; border:1px solid #444; background:#111; color:#eee; font-size:1rem;
    }
    textarea { resize:vertical; height:80px; }
    button { 
      margin:8px 6px; padding:10px 20px; border-radius:8px; border:none;
      background:#1d9bf0; color:white; font-weight:600; cursor:pointer;
    }
    button:hover { background:#0c85d0; }
    #sendEmail { background:#0f5; }
    #sendEmail:hover { background:#0c3; }
    #status, #gps { font-size:0.95rem; color:#0f5; margin:10px 0; min-height:1.4em; }
    .error  { color:#f66 !important; }
    .success { color:#0f5 !important; }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="overlay">
    <h1>Root Donate Map</h1>
    <div id="gps">GPS: checking...</div>
    <div id="status">Jan 21, 2026 â€¢ @iandreme â€¢ Email â†’ Map demo</div>
  </div>

  <script>
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Replace these with YOUR EmailJS values
    emailjs.init({ publicKey: "1oXeNo5ZXiRcipyWo" });  // â† your public key

    const SERVICE_ID   = "amql3dos";     // e.g. service_abc123
    const TEMPLATE_ID  = "template_u6wxza9";    // e.g. template_xyz789
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const map = L.map('map').setView([53.4631, -2.2913], 13);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/{z}/{x}/{y}{r}.png', {
      attribution: 'Â© OpenStreetMap & CARTO'
    }).addTo(map);

    const greenDot = L.divIcon({
      className: 'dot',
      html: '<div style="background:#0f5;width:18px;height:18px;border-radius:50%;border:3px solid #fff;box-shadow:0 0 10px #0f5;"></div>',
      iconSize: [18,18],
      iconAnchor: [9,9]
    });

    let myLat = 53.4631;
    let myLng = -2.2913;

    // Watch real user location
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(pos => {
        myLat = pos.coords.latitude;
        myLng = pos.coords.longitude;
        document.getElementById('gps').textContent = `GPS: ${myLat.toFixed(5)}, ${myLng.toFixed(5)}`;
      }, () => {
        document.getElementById('gps').textContent = 'GPS unavailable â€” using Carrington default';
      }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
    } else {
      document.getElementById('gps').textContent = 'No geolocation support in this browser';
    }

    // Add marker helper
    function addMarker(lat, lng, text, hasMedia = false) {
      const popup = `
        <b>@iandreme</b><br>
        ${text || '(no message)'}<br>
        ${hasMedia ? 'ğŸ“¸ Has media' : ''}<br>
        <small>${new Date().toLocaleString()}</small>
      `;
      L.marker([lat, lng], { icon: greenDot }).addTo(map).bindPopup(popup);
    }

    // Clear markers (except base layer)
    function clearMarkers() {
      map.eachLayer(layer => {
        if (layer instanceof L.Marker) map.removeLayer(layer);
      });
    }

    // Load dummy/test markers
    function loadTestMarkers() {
      clearMarkers();
      const tests = [
        { lat: 53.4631, lng: -2.2913, text: "Hello World from Carrington! âš½ #MUFC" },
        { lat: 53.465,  lng: -2.285,  text: "Training day vibes" },
        { lat: 53.460,  lng: -2.295,  text: "Carrick masterclass loading..." }
      ];
      tests.forEach(t => addMarker(t.lat, t.lng, t.text, false));
      setTimeout(() => {
        document.getElementById('status').textContent = 'Test markers loaded â€¢ Send your own!';
      }, 1200);
    }

    // Initial load
    loadTestMarkers();
    addMarker(53.4631, -2.2913, "Hello World! Send your message â†’", false);

    // â”€â”€â”€ Send Email â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('sendEmail').addEventListener('click', () => {
      const name    = document.getElementById('name').value.trim()    || 'Anonymous';
      const email   = document.getElementById('email').value.trim()   || 'no-reply@example.com';
      const message = document.getElementById('message').value.trim();

      const status = document.getElementById('status');

      if (!message) {
        status.textContent = 'Please enter a message!';
        status.className = 'error';
        setTimeout(() => { status.textContent = 'Ready'; status.className = ''; }, 4000);
        return;
      }

      const templateParams = {
        from_name:    name,
        reply_to:     email,
        message:      message,
        latitude:     myLat.toFixed(6),
        longitude:    myLng.toFixed(6),
        gps_text:    `GPS: ${myLat.toFixed(5)}, ${myLng.toFixed(5)}`,
        user_handle:  '@iandreme',
        timestamp:    new Date().toLocaleString(),
        subject:      `Map Drop from ${name} #MUFC`
      };

      status.textContent = 'Sending...';
      status.className = '';

      emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
        .then((response) => {
          console.log('SUCCESS', response.status, response.text);
          status.textContent = 'Email sent successfully! Thanks âš½';
          status.className = 'success';
          // Also show on map
          addMarker(myLat, myLng, `${name}: ${message.substring(0,60)}${message.length>60?'...':''}`, false);
          // Optional: clear input
          document.getElementById('message').value = '';
        })
        .catch((err) => {
          console.error('FAILED', err);
          status.textContent = 'Failed to send â€“ check console or try again';
          status.className = 'error';
        })
        .finally(() => {
          setTimeout(() => {
            status.textContent = 'Jan 21, 2026 â€¢ @iandreme â€¢ Email â†’ Map demo';
            status.className = '';
          }, 6000);
        });
    });

    // Refresh / re-center button
    document.getElementById('refresh').addEventListener('click', () => {
      map.setView([myLat, myLng], 15);
      document.getElementById('status').textContent = 'Map centered on current position';
    });
  </script>
</body>
</html>