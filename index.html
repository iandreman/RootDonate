<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RootDonate • The Apple Maps of the Internet</title>
  <meta name="description" content="The most beautiful real-time map of the global Internet backbone — now with real IPs.">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-polyline-decorator@1.6.0/dist/leaflet.polylineDecorator.min.js"></script>

  <style>
    :root { --primary:#0a84ff; --green:#30d158; --glow:0 0 20px rgba(10,132,255,0.6); }
    *,*::before,*::after { box-sizing:border-box; }
    body,html { margin:0;padding:0;height:100%;overflow:hidden;background:#000;color:#fff;font-family:-apple-system,system-ui,sans-serif; }
    #map { width:100%;height:100%;background:#000; }

    .header { position:absolute;top:0;left:0;right:0;padding:2.6rem 1.5rem 1.8rem;text-align:center;z-index:1000;
      background:linear-gradient(to bottom,rgba(0,0,0,0.94),transparent);backdrop-filter:blur(36px);pointer-events:none; }
    .header h1 { margin:0;font-size:3.4rem;font-weight:900;letter-spacing:-1.4px;
      background:linear-gradient(90deg,#0a84ff,#30d158);-webkit-background-clip:text;background-clip:text;color:transparent; }
    .header p { margin:0.7rem 0 0;font-size:1.38rem;font-weight:600;opacity:0.94; }

    .controls { position:absolute;top:146px;left:50%;transform:translateX(-50%);z-index:1000;
      background:rgba(28,28,30,0.97);backdrop-filter:blur(44px);border-radius:26px;padding:1.2rem 1.5rem;
      display:flex;gap:1.3rem;align-items:center;box-shadow:0 28px 70px rgba(0,0,0,0.8);border:1px solid rgba(255,255,255,0.1); }
    #search { padding:1.2rem 1.8rem;width:460px;border:none;border-radius:22px;background:rgba(255,255,255,0.16);color:white;font-size:1.18rem;font-weight:500;
      transition:all 0.38s cubic-bezier(0.2,0.8,0.2,1); }
    #search:focus { outline:none;background:rgba(255,255,255,0.26);transform:scale(1.045);box-shadow:var(--glow); }

    button { background:var(--primary);color:white;border:none;padding:1.2rem 2rem;border-radius:22px;cursor:pointer;font-weight:700;
      transition:all 0.32s cubic-bezier(0.2,0.8,0.4,1);box-shadow:0 10px 24px rgba(10,132,255,0.45); }
    button:hover { transform:translateY(-4px) scale(1.08);box-shadow:0 20px 40px rgba(10,132,255,0.55); }

    .legend { position:absolute;top:146px;right:22px;z-index:1000;background:rgba(28,28,30,0.97);backdrop-filter:blur(36px);
      border-radius:22px;padding:1.5rem 1.7rem;font-size:1rem;min-width:300px;border:1px solid rgba(255,255,255,0.09);
      box-shadow:0 24px 60px rgba(0,0,0,0.7); }
    .legend-item { display:flex;align-items:center;gap:18px;margin:16px 0;font-weight:600; }
    .legend-color { width:24px;height:24px;border-radius:50%;box-shadow:0 5px 14px rgba(0,0,0,0.5); }

    .status { position:absolute;bottom:26px;left:26px;z-index:1000;background:rgba(0,0,0,0.85);padding:1rem 1.5rem;border-radius:18px;
      font-size:1rem;font-weight:700;backdrop-filter:blur(22px);border-left:7px solid var(--green);box-shadow:0 14px 36px rgba(0,0,0,0.6); }

    footer { position:absolute;bottom:0;left:0;right:0;padding:18px;text-align:center;background:rgba(0,0,0,0.92);
      backdrop-filter:blur(18px);font-size:0.9rem;color:rgba(255,255,255,0.75);font-weight:500;z-index:1000; }

    .pulse { animation:pulse 4s infinite; }
    @keyframes pulse { 0%,100% { opacity:0.96;transform:scale(1); } 50% { opacity:1;transform:scale(1.28);box-shadow:var(--glow); } }

    .ip { font-family:Menlo,Monaco,Consolas,monospace;font-size:0.92em;background:rgba(255,255,255,0.1);padding:4px 9px;border-radius:8px;margin-top:8px;display:inline-block; }
  </style>
</head>
<body>

  <div id="map"></div>

  <div class="header">
    <h1>RootDonate</h1>
    <p>The Apple Maps of the Internet • Now with Real IPs • 2025</p>
  </div>

  <div class="controls">
    <input type="text" id="search" placeholder="Search IXP, city, ASN, IP, datacenter…" autocomplete="off">
    <button id="locate">Locate Me</button>
    <button id="cables">Submarine Cables</button>
  </div>

  <div class="legend">
    <div class="legend-item"><div class="legend-color" style="background:#0a84ff"></div> Internet Exchange (IXP)</div>
    <div class="legend-item"><div class="legend-color" style="background:#32d74b"></div> Carrier Hotel</div>
    <div class="legend-item"><div class="legend-color" style="background:#30d158"></div> Live Traffic</div>
    <div class="legend-item"><div class="legend-color" style="background:#ff453a"></div> Outage</div>
  </div>

  <div class="status">Status: <span id="status-text">Live • Real IPs • Global Backbone</span></div>
  <footer>© 2025 RootDonate • The most beautiful Internet map ever made • With love & IPs</footer>

  <script>
    const map = L.map('map', {
      zoomControl: false, minZoom: 2.3, maxZoom: 11, zoomSnap: 0.5, zoomDelta: 0.75, wheelPxPerZoomLevel: 120
    }).setView([20, 0], 2.7);

    L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
      attribution: '', maxZoom: 20
    }).addTo(map);

    L.control.zoom({ position: 'topright' }).addTo(map);

    const ixps = L.layerGroup().addTo(map);
    const cablesLayer = L.layerGroup();
    let cablesVisible = false;

    const nodes = [
      {name:"DE-CIX Frankfurt", lat:50.1155, lon:8.6842, type:"fix", peak:"15+ Tbps", ip4:"80.81.192.0", ip6:"2001:7f8::", asn:"6695"},
      {name:"AMS-IX Amsterdam", lat:52.3740, lon:4.8897, type:"fix", peak:"11+ Tbps", ip4:"195.69.144.0", ip6:"2001:7f8:1::", asn:"1200"},
      {name:"LINX LON1 London", lat:51.5155, lon:-0.0922, type:"fix", peak:"7+ Tbps", ip4:"195.66.224.0", ip6:"2001:7f8:4::", asn:"5459"},
      {name:"Equinix Ashburn", lat:39.0437, lon:-77.4874, type:"fac", desc:"Internet Capital", ip4:"206.126.236.0", ip6:"2001:504:1a::"},
      {name:"IX.br São Paulo PTT", lat:-23.5505, lon:-46.6333, type:"fix", peak:"20+ Tbps", ip4:"187.16.216.0", ip6:"2001:12f8::", asn:"22548"},
      {name:"FL-IX Miami", lat:25.7617, lon:-80.1918, type:"fix", peak:"4+ Tbps", ip4:"206.41.104.0", ip6:"2001:504:40::"},
      {name:"JPIX Tokyo", lat:35.6895, lon:139.6917, type:"fix", ip4:"210.171.224.0", ip6:"2001:7fa:7::"},
      {name:"Equinix Singapore", lat:1.3214, lon:103.8445, type:"fac", ip4:"27.111.228.0", ip6:"2001:de8:7::"},
      {name:"HKIX Hong Kong", lat:22.3964, lon:114.1095, type:"fix", ip4:"202.12.28.0", ip6:"2001:7fa:0::"},
      {name:"MSK-IX Moscow", lat:55.7558, lon:37.6173, type:"fix", ip4:"195.208.208.0", ip6:"2001:7f8:20::"},
      {name:"NYIIX New York", lat:40.7128, lon:-74.0060, type:"fix", ip4:"198.32.160.0", ip6:"2001:504:1::"},
      {name:"BBIX Tokyo", lat:35.6762, lon:139.6503, type:"fix", ip4:"218.100.8.0", ip6:"2001:de8:c::"}
    ];

    const markers = [];

    nodes.forEach(n => {
      const isIXP = n.type === "fix";
      const color = isIXP ? "#0a84ff" : "#32d74b";
      const radius = isIXP ? 24 : 22;

      const m = L.circleMarker([n.lat, n.lon], {
        radius, fillColor: color, color: "#fff", weight: 5, opacity: 1, fillOpacity: 0.96
      }).addTo(ixps);

      m.bindPopup(`
        <div style="font-family:system-ui;line-height:1.5;">
          <b style="font-size:1.55em;font-weight:900;">${n.name}</b><br>
          <small style="opacity:0.7;">ASN ${n.asn || "—"}</small><br>
          ${n.peak ? `<b>Peak:</b> ${n.peak}<br>` : ""}
          ${n.ip4 ? `<div class="ip">${n.ip4}/20 (IPv4)</div>` : ""}
          ${n.ip6 ? `<div class="ip">${n.ip6}/64 (IPv6)</div>` : ""}
          <i style="opacity:0.88;margin-top:8px;display:block;">${n.desc || (isIXP ? "Major Internet Exchange Point" : "Global Carrier Hotel")}</i>
        </div>
      `, { closeButton: false });

      if (Math.random() > 0.35) m.getElement()?.classList.add("pulse");

      markers.push({ marker: m, name: n.name.toLowerCase(), ip4: n.ip4, ip6: n.ip6, asn: n.asn });
    });

    // Search now includes IPs!
    document.getElementById("search").addEventListener("input", e => {
      const term = e.target.value.toLowerCase().trim();
      markers.forEach(item => {
        const matches = item.name.includes(term) ||
                        (item.asn && item.asn.includes(term)) ||
                        (item.ip4 && item.ip4.includes(term)) ||
                        (item.ip6 && item.ip6.includes(term));
        item.marker.setStyle({
          fillOpacity: term === "" ? 0.96 : (matches ? 1 : 0.16),
          radius: matches && term !== "" ? 30 : item.marker.options.radius
        });
        if (matches && term) item.marker.openPopup();
      });
    });

    // Submarine cables (same as before, with animated flow)
    const cables = [
      [[39.0437,-77.4874],[51.5155,-0.0922]], [[39.0437,-77.4874],[25.7617,-80.1918]],
      [[25.7617,-80.1918],[-23.5505,-46.6333]], [[51.5155,-0.0922],[50.1155,8.6842]],
      [[50.1155,8.6842],[52.3740,4.8897]], [[1.3214,103.8445],[35.6895,139.6917]],
      [[22.3964,114.1095],[35.6895,139.6917]], [[39.0437,-77.4874],[1.3214,103.8445]]
    ];

    document.getElementById("cables").onclick = () => {
      if (cablesVisible) { map.removeLayer(cablesLayer); cablesVisible = false; }
      else {
        cables.forEach(r => {
          const line = L.polyline(r, { color: '#30d158', weight: 5, opacity: 0.85 }).addTo(cablesLayer);
          L.polylineDecorator(line, {
            patterns: [{ offset: 30, repeat: 130, symbol: L.Symbol.arrowHead({
              pixelSize: 15, headAngle: 60, pathOptions: { color: '#30d158', weight: 5, fillOpacity: 1 }
            })}]
          }).addTo(cablesLayer);
        });
        cablesLayer.addTo(map); cablesVisible = true;
      }
    };

    // Locate Me
    document.getElementById("locate").onclick = () => {
      map.locate({ setView: true, maxZoom: 9 });
      map.once("locationfound", e => {
        L.circleMarker(e.latlng, { radius: 22, color: "#fff", weight: 7, fillColor: "#0a84ff", fillOpacity: 0.94 })
          .addTo(map).bindPopup("<b>You are here</b>").openPopup();
      });
    };

    // Live status rotation
    setInterval(() => {
      const texts = ["Live • Real IPs • Global Backbone", "Live • 200+ Tbps Combined", "Live • Pure Internet Poetry", "Live • Forever Free & Open"];
      document.getElementById("status-text").textContent = texts[Math.floor(Math.random() * texts.length)];
    }, 9000);

    // Random live pulses
    setInterval(() => {
      ixps.eachLayer(m => {
        if (Math.random() < 0.28) {
          m.setStyle({ fillColor: "#30d158" });
          setTimeout(() => m.setStyle({ fillColor: m.options.fillColor === "#0a84ff" ? "#0a84ff" : "#32d74b" }), 3800);
        }
      });
    }, 4000);
  </script>
</body>
</html>
