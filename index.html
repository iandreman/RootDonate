<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Share Root Donate Pin to X â€¢ Swagga Rico</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">

  <style>
    body {
      background: #0a0a12;
      color: #e0e0ff;
      font-family: 'Inter', system-ui, sans-serif;
      margin: 0;
      padding: 20px 20px 60px;
      min-height: 100vh;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(120,80,255,0.08) 0%, transparent 50%),
        radial-gradient(circle at 90% 80%, rgba(52,211,153,0.07) 0%, transparent 50%);
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1.glow {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(2.5rem, 8vw, 4.2rem);
      font-weight: 900;
      text-align: center;
      margin: 30px 0 8px;
      background: linear-gradient(90deg, #a78bfa, #7dd3fc, #34d399);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 30px rgba(52,211,153,0.35);
    }
    .subtitle { text-align: center; color: #a0a0ff; margin-bottom: 30px; font-size: 1.1rem; }
    .pin-selector {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(52,211,153,0.25);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
    }
    select, button, textarea {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.05);
      color: white;
      font-size: 1rem;
    }
    button {
      background: linear-gradient(45deg, #7c3aed, #3b82f6);
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59,130,246,0.4); }
    .preview {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(120,80,255,0.2);
      border-radius: 12px;
      padding: 20px;
      margin-top: 25px;
      backdrop-filter: blur(6px);
    }
    .preview h3 { margin-top: 0; color: #34d399; }
    .copy-btn {
      margin-top: 12px;
      background: linear-gradient(45deg, #6366f1, #a78bfa);
    }
    .static-map {
      max-width: 100%;
      border-radius: 10px;
      margin: 15px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .status { padding: 12px; border-radius: 10px; text-align: center; margin: 15px 0; display: none; }
    .status.success { background: rgba(52,211,153,0.25); color: #34d399; }
    .status.error { background: rgba(239,68,68,0.25); color: #ef4444; }
  </style>
</head>
<body>

  <div class="container">
    <h1 class="glow">SHARE PIN TO X</h1>
    <div class="subtitle">Generate X-ready posts with map previews â€¢ Root Donate pins</div>

    <div id="status" class="status"></div>

    <div class="pin-selector">
      <label for="pin-select">Select a pin to share:</label>
      <select id="pin-select">
        <option value="">â€” Choose a saved pin â€”</option>
      </select>

      <button onclick="generateShare()">Generate X Post Templates</button>
    </div>

    <div id="share-preview" class="preview" style="display:none;">
      <h3>Pin Selected: <span id="pin-name"></span></h3>
      
      <p><strong>Best for map card preview (try this first):</strong></p>
      <textarea id="best-tweet" rows="5" readonly></textarea>
      <button class="copy-btn" onclick="copyToClipboard('best-tweet')">Copy Best Tweet Text</button>

      <p><strong>Fallback with static map image (always shows pin):</strong></p>
      <img id="static-map-img" class="static-map" alt="Static map preview">
      <textarea id="image-tweet" rows="4" readonly></textarea>
      <button class="copy-btn" onclick="copyToClipboard('image-tweet')">Copy Image + Link Tweet</button>

      <p><strong>Root Donate deep link only:</strong></p>
      <textarea id="rd-tweet" rows="3" readonly></textarea>
      <button class="copy-btn" onclick="copyToClipboard('rd-tweet')">Copy RD-only Tweet</button>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'root_donate_pins';

    function getPins() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch { return []; }
    }

    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
    }

    function showStatus(msg, type = 'success') {
      const el = document.getElementById('status');
      el.textContent = msg;
      el.className = 'status ' + type;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 4000);
    }

    function populatePinSelector() {
      const pins = getPins();
      const select = document.getElementById('pin-select');
      select.innerHTML = '<option value="">â€” Choose a saved pin â€”</option>';

      if (pins.length === 0) {
        select.innerHTML += '<option disabled>No pins found in localStorage</option>';
        showStatus('No pins saved yet â€” add some in Root Donate first', 'error');
        return;
      }

      pins.forEach((pin, i) => {
        const name = pin.name || 'Pin #' + (i+1);
        const dt = new Date(pin.time).toLocaleDateString();
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `${name} (${dt}) â€¢ ${pin.lat.toFixed(5)}, ${pin.lng.toFixed(5)}`;
        select.appendChild(opt);
      });
    }

    function generateGoogleShortLink(lat, lng, label) {
      // Note: In real use you'd generate via Google Maps UI and paste short link.
      // This is a placeholder â€” best results come from actual short links.
      // For demo: using full link that often still previews well.
      const q = encodeURIComponent(`${label || 'Pin'} ${lat},${lng}`);
      return `https://www.google.com/maps?q=${lat},${lng}&z=16`;
      // Preferred: get short goo.gl/maps or maps.app.goo.gl via sharing from Maps app
    }

    function generateStaticMap(lat, lng, label) {
      const escapedLabel = encodeURIComponent(label || 'ðŸ“');
      return `https://maps.googleapis.com/maps/api/staticmap?center=${lat},${lng}&zoom=15&size=500x300&markers=color:red%7Clabel:${escapedLabel[0]}%7C${lat},${lng}&key=AIzaSyDNoexampleNoKeyNeededForBasic&scale=2`;
      // No key needed for very low volume â€” if rate-limited, get free key from Google Cloud
    }

    function generateShare() {
      const idx = document.getElementById('pin-select').value;
      if (!idx || isNaN(idx)) return showStatus('Select a pin first', 'error');

      const pins = getPins();
      const pin = pins[idx];

      const name = escapeHTML(pin.name || 'Anonymous Pin');
      const msg = escapeHTML(pin.msg || '(no message)').substring(0, 120) + '...';
      const lat = pin.lat.toFixed(6);
      const lng = pin.lng.toFixed(6);
      const coords = `${lat}, ${lng}`;

      const gmapsLink = generateGoogleShortLink(lat, lng, name);
      // In practice: replace with real short link from Google Maps share
      const rdLink = `${window.location.origin}/#pin=${btoa(JSON.stringify(pin))}`; // adjust base URL if needed
      const staticMapUrl = generateStaticMap(lat, lng, name);

      document.getElementById('pin-name').textContent = name;

      // Best preview attempt
      document.getElementById('best-tweet').value = 
`ðŸ“ ${name}

${msg}

${coords}

${gmapsLink}

via Root Donate â†’ ${rdLink}`;

      // Static image fallback
      document.getElementById('static-map-img').src = staticMapUrl;
      document.getElementById('image-tweet').value = 
`ðŸ“ ${name} â€” ${msg}

[attach the map image above]

Click for full details: ${rdLink}
${gmapsLink}`;

      // RD only
      document.getElementById('rd-tweet').value = 
`New Root Donate pin dropped ðŸ“

${name}: ${msg}

Check it: ${rdLink}`;

      document.getElementById('share-preview').style.display = 'block';
      showStatus('X post templates ready! Copy & paste into X');
    }

    function copyToClipboard(elementId) {
      const el = document.getElementById(elementId);
      el.select();
      navigator.clipboard.writeText(el.value).then(() => {
        showStatus('Copied to clipboard! Paste into X now');
      }).catch(() => {
        showStatus('Copy failed â€” select text manually', 'error');
      });
    }

    // Init
    populatePinSelector();
  </script>
</body>
</html>